# /etc/init/stats.conf

description "Meetin.gs statistics"
author      "Tuomas Starck <dev@starck.fi>"

start on (local-filesystems and net-device-up IFACE!=lo)
stop  on (githupdate or runlevel [016])

respawn
respawn limit 10 10

setuid nobody
setgid nogroup

script
  set -e
  FIFO=`mktemp --dry-run`
  mkfifo $FIFO
  (logger -t stats -p local2.info <$FIFO &)
  exec >$FIFO
  rm $FIFO
  export VERSION_FILE=/etc/the_service_version
  exec /usr/local/bin/stats 2>&1
end script
